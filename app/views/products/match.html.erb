<% if @product %>
  <div class="row">

    <div class="col-md-3">
      <%= image_tag @product.image, class: "img-responsive" %>
    </div>
    <div class="col-md-3">
      <div class="row">
        <% @product.additional_images[0...4].each do |img| %>
          <div class="col-md-6"><%= image_tag img, class: "img-responsive" %></div>
        <% end %>
      </div>

    </div>

    <div class="col-md-3">
      <h4><%= link_to @product.title, match_path(product_id: @product.id) %></h4>
      <table class="table">
        <tr><td>Brand:</td><td><%= @product.brand.name || 'N/A' %></td></tr>
        <tr><td>Color:</td><td><%= @product.color || 'N/A' %></td></tr>
        <tr><td>Size:</td><td><%= @product.size|| 'N/A' %></td></tr>
        <tr><td>Price:</td><td><%= @product.price || 'N/A' %><%= " (#{@product.price_sale})" if @product.price_sale.present? && @product.price != @product.price_sale %></td></tr>
        <tr><td>Material:</td><td><%= @product.material || 'N/A' %></td></tr>
        <tr><td>Bop Cat:</td><td><%= @product.category %></td></tr>
        <tr><td>Goog Cat:</td><td><%= @product.google_category %></td></tr>
        <tr><td>Style Code:</td><td><%= @product.style_code %></td></tr>
        <tr><td colspan="2"><%= link_to 'Shopbop Product Link', @product.url, target: :_blank %></td></tr>
      </table>
    </div>
    <div class="col-md-3">
      <% unless params[:product_id] %>
        <%= select_tag 'brand', options_from_collection_for_select(@brands_choose, :id, :name, @brand.id), class: "form-control select2 match-brand" %>
        <div style="height: 2px; width: 1px; clear: both;">&nbsp;</div>
        <%= link_to 'Brand statistic', products_statistic_path(brand_id: @brand.id), class: 'btn btn-default pull-right', target: :_blank %>
        <div style="height: 2px; width: 1px; clear: both;">&nbsp;</div>
        <%= link_to 'Undo previous match', match_undo_path(brand_id: @brand.id), class: 'btn btn-default select-action pull-right', remote: true, method: :post %>
        <div style="height: 2px; width: 1px; clear: both;">&nbsp;</div>
        <% show_formats = {
          all: 'All',
          not_matched: "Not matched",
          has_green: 'Has green',
        } %>
        <div class="dropdown pull-right">
          <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
            Show <%= params[:only] && show_formats[params[:only].to_sym] || 'All' %>
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu scrollable-menu" aria-labelledby="dropdownMenu1">
            <% show_formats.each do |param, label| %>
              <li><%= link_to label, match_path(brand_id: @brand.id, only: param) %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
    </div>
  </div>

  <% if @product.upc.present? && product_upc = ProductUpc.where(product_id: @product.id).first %>
    <% product = product_upc.selected %>
    <h2>This product already matched with:</h2>
    <div class="row">
      <div class="col-sm-3 col-xs-6">
        <div class="thumbnail" data-id="<%= product.id %>">
          <strong><%= product.title %></strong></br>
          <em>Color:</em> <%= product.color %></br>
          <em>Size:</em> <%= product.size %></br>
          <em>Price:</em> <%= product.price %><%= " (#{product.price_sale})" if product.price_sale.present? && product.price != product.price_sale %></br>
          <!--<em>Category:</em> <%= product.category %></br>-->
          <em>Source:</em> <%= product.source %><%= "(#{product.retailer})" if product.retailer.present? %></br>
          <em>UPC:</em> <%= product.upc %></br>

          <div style="margin: 5px 0;">
            <%= link_to image_tag(product_image(product.image), class: "img-responsive portfolio-item"), product.url, target: :_blank %>
          </div>
        </div>
      </div>
    </div>
  <% else %>
    <div class="row">
      <div class="col-lg-12">
        <div class="pull-right page-header" style='margin-top: 30px;' >
          <%= link_to 'No Color', select_path(product_id: @product.id, decision: 'no-color'), class: 'btn btn-danger select-action', remote: true, method: :post %>
          <%= link_to 'No Size', select_path(product_id: @product.id, decision: 'no-size'), class: 'btn btn-danger select-action', remote: true, method: :post %>
          <%= link_to 'Nothing', select_path(product_id: @product.id, decision: :nothing), class: 'btn btn-danger select-action', remote: true, method: :post %>
        </div>
        <h4 class="page-header">Select Matched Product:</h4>
      </div>
    </div>

    <% @suggested_products.in_groups_of(4, false) do |products| %>
      <div class="row">
        <% products.each do |suggested_product| %>
          <% product = suggested_product.suggested %>
          <div class="col-sm-3 col-xs-6" data-percentage="<%= suggested_product.percentage %>">
            <div class="thumbnail<%= ' same-as-green' if suggested_product.percentage < 100 && @suggested_products.select{|s| s.percentage == 100 && s.suggested.upc == product.upc}.size > 0 %>" style="background: <%= match_item_bg suggested_product %>" data-id="<%= product.id %>">
              <strong><%= product.title %></strong></br>
              <table class="suggested-product-table">
                <tr><td>Color:</td><td><%= product.color %></td></tr>
                <tr><td>Size:</td><td><%= product.size %></td></tr>
                <tr><td>Price:</td><td><%= product.price %><%= " (#{product.price_sale})" if product.price_sale.present? && product.price != product.price_sale %></td></tr>
                <tr><td>Source:</td><td><%= product.source %><%= "(#{product.retailer})" if product.retailer.present? %></td></tr>
                <tr><td>UPC:</td><td class="value"><span><%= product.upc %></span></td></tr>
              </table>

              <div style="margin: 5px 0;" class="portfolio-item suggestion-images">
                <%= image_tag(product_image(product.image), class: 'main-image img-responsive') %>
                <% product.additional_images.each do |ad_image| %>
                  <%= image_tag(product_image(ad_image), class: 'additional-image img-responsive') %>
                <% end %>
              </div>

              <%= link_to 'Found', select_path(product_id: @product.id, selected_id: product.id, decision: :found), class: "btn btn-success select-action", remote: true, method: :post %>
              <%= link_to 'Similar', select_path(product_id: @product.id, selected_id: product.id, decision: :similar), class: "btn btn-warning select-action", remote: true, method: :post %>
              <%= link_to 'Source', product.url, class: "btn btn-default pull-right" %>
            </div>
          </div>
        <% end %>
      </div>
      <br>
    <% end %>
  <% end %>

<% else %>
  <div class="row">
    <div class="col-sm-8">
      <h3>There is no products for you</h3>
    </div>
    <div class="col-sm-4">
      <%= select_tag 'brand', options_from_collection_for_select(@brands_choose, :id, :name, @brand.id), class: "form-control select2 match-brand" %>
      <div style="height: 2px; width: 1px; clear: both;">&nbsp;</div>
      <%= link_to 'Brand statistic', products_statistic_path(brand_id: @brand.id), class: 'btn btn-default pull-right', target: :_blank %>
      <div style="height: 2px; width: 1px; clear: both;">&nbsp;</div>
      <% show_formats = {
        all: 'All',
        not_matched: "Not matched",
        has_green: 'Has green',
      } %>
      <div class="dropdown pull-right">
        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          Show <%= params[:only] && show_formats[params[:only].to_sym] || 'All' %>
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu scrollable-menu" aria-labelledby="dropdownMenu1">
          <% show_formats.each do |param, label| %>
            <li><%= link_to label, match_path(brand_id: @brand.id, only: param) %></li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>

<% end %>